defmodule ReceiptDecoder.ParserTest do
  use ExUnit.Case

  alias ReceiptDecoder.Parser

  describe "parse/1" do
    test "parse payload" do
      data = Parser.parse(payload())

      application_version =
        data
        |> Keyword.get(:application_version)

      assert application_version == "1241"
    end
  end

  defp payload do
    [{:ReceiptAttribute, 8, 1, <<22, 0>>}, {:ReceiptAttribute, 20, 1, <<12, 0>>},
     {:ReceiptAttribute, 1, 1, <<2, 1, 0>>},
     {:ReceiptAttribute, 11, 1, <<2, 1, 0>>},
     {:ReceiptAttribute, 14, 1, <<2, 1, 89>>},
     {:ReceiptAttribute, 15, 1, <<2, 1, 0>>},
     {:ReceiptAttribute, 16, 1, <<2, 1, 0>>},
     {:ReceiptAttribute, 25, 1, <<2, 1, 3>>},
     {:ReceiptAttribute, 10, 1, <<22, 2, 52, 43>>},
     {:ReceiptAttribute, 13, 1, <<2, 3, 1, 56, 128>>},
     {:ReceiptAttribute, 19, 1, <<12, 3, 49, 46, 48>>},
     {:ReceiptAttribute, 3, 1, <<12, 4, 49, 50, 52, 49>>},
     {:ReceiptAttribute, 9, 1, <<2, 4, 80, 50, 51, 49>>},
     {:ReceiptAttribute, 4, 2,
       <<55, 223, 114, 56, 138, 79, 247, 183, 9, 37, 209, 28, 7, 147, 201, 131>>},
     {:ReceiptAttribute, 0, 1,
       <<12, 17, 80, 114, 111, 100, 117, 99, 116, 105, 111, 110, 83, 97, 110, 100,
       98, 111, 120>>},
     {:ReceiptAttribute, 5, 1,
       <<253, 23, 138, 194, 193, 253, 204, 39, 239, 220, 43, 200, 223, 213, 74, 210,
       39, 101, 79, 47>>},
     {:ReceiptAttribute, 12, 1,
       <<22, 20, 50, 48, 49, 52, 45, 48, 57, 45, 48, 50, 84, 48, 51, 58, 50, 57, 58,
       48, 54, 90>>},
     {:ReceiptAttribute, 18, 1,
       <<22, 20, 50, 48, 49, 51, 45, 48, 56, 45, 48, 49, 84, 48, 55, 58, 48, 48, 58,
       48, 48, 90>>},
     {:ReceiptAttribute, 2, 1,
       <<12, 21, 99, 111, 109, 46, 115, 117, 109, 105, 97, 112, 112, 46, 71, 114,
       105, 100, 68, 105, 97, 114, 121>>},
     {:ReceiptAttribute, 7, 1,
       <<119, 192, 104, 221, 70, 248, 221, 242, 110, 31, 208, 133, 128, 133, 41, 70,
       250, 248, 163, 156, 82, 123, 97, 14, 223, 165, 185, 27, 222, 128, 15, 19,
       160, 106, 210, 117, 91, 74, 116, 227, 187, 193, 85, 194, 204, 59, 67, 29, 2,
       17, 94, 32, 165, 223, 122, 0, 22, 74, 28, 115, 124, 125, 46, 242, 76>>},
     {:ReceiptAttribute, 6, 1,
       <<58, 111, 80, 174, 231, 1, 187, 56, 232, 83, 20, 41, 204, 35, 219, 178, 228,
       237, 57, 205, 78, 104, 116, 31, 66, 189, 18, 210, 223, 129, 243, 235, 36, 7,
       188, 123, 70, 21, 94, 192, 9, 35, 0, 103, 31, 66, 20, 21, 61, 172, 127, 172,
       175, 77, 253, 254, 114, 208, 164, 229, 95, 253, 136, 127, 185, 81, 87, 68,
       150, 29, 235, 141, 115, 148, 98, 112>>},
     {:ReceiptAttribute, 17, 1,
       <<49, 130, 1, 80, 48, 11, 2, 2, 6, 172, 2, 1, 1, 4, 2, 22, 0, 48, 11, 2, 2, 6,
       173, 2, 1, 1, 4, 2, 12, 0, 48, 11, 2, 2, 6, 176, 2, 1, 1, 4, 2, 22, 0, 48,
       11, 2, 2, 6, 178, 2, 1, 1, 4, 2, 12, 0, 48, 11, 2, 2, 6, 179, 2, 1, 1, 4, 2,
       12, 0, 48, 11, 2, 2, 6, 180, 2, 1, 1, 4, 2, 12, 0, 48, 11, 2, 2, 6, 181, 2,
       1, 1, 4, 2, 12, 0, 48, 11, 2, 2, 6, 182, 2, 1, 1, 4, 2, 12, 0, 48, 12, 2, 2,
       6, 165, 2, 1, 1, 4, 3, 2, 1, 1, 48, 12, 2, 2, 6, 171, 2, 1, 1, 4, 3, 2, 1,
       0, 48, 12, 2, 2, 6, 174, 2, 1, 1, 4, 3, 2, 1, 0, 48, 12, 2, 2, 6, 175, 2, 1,
       1, 4, 3, 2, 1, 0, 48, 12, 2, 2, 6, 177, 2, 1, 1, 4, 3, 2, 1, 0, 48, 27, 2,
       2, 6, 167, 2, 1, 1, 4, 18, 12, 16, 49, 48, 48, 48, 48, 48, 48, 49, 49, 56,
       57, 57, 48, 56, 50, 56, 48, 27, 2, 2, 6, 169, 2, 1, 1, 4, 18, 12, 16, 49,
       48, 48, 48, 48, 48, 48, 49, 49, 56, 57, 57, 48, 56, 50, 56, 48, 31, 2, 2, 6,
       168, 2, 1, 1, 4, 22, 22, 20, 50, 48, 49, 52, 45, 48, 57, 45, 48, 50, 84, 48,
       51, 58, 50, 57, 58, 48, 54, 90, 48, 31, 2, 2, 6, 170, 2, 1, 1, 4, 22, 22,
       20, 50, 48, 49, 52, 45, 48, 56, 45, 48, 52, 84, 48, 54, 58, 50, 52, 58, 53,
       49, 90, 48, 36, 2, 2, 6, 166, 2, 1, 1, 4, 27, 12, 25, 99, 111, 109, 46, 115,
       117, 109, 105, 97, 112, 112, 46, 71, 114, 105, 100, 68, 105, 97, 114, 121,
       46, 112, 114, 111>>},
     {:ReceiptAttribute, 17, 1,
       <<49, 130, 1, 81, 48, 11, 2, 2, 6, 172, 2, 1, 1, 4, 2, 22, 0, 48, 11, 2, 2, 6,
       173, 2, 1, 1, 4, 2, 12, 0, 48, 11, 2, 2, 6, 176, 2, 1, 1, 4, 2, 22, 0, 48,
       11, 2, 2, 6, 178, 2, 1, 1, 4, 2, 12, 0, 48, 11, 2, 2, 6, 179, 2, 1, 1, 4, 2,
       12, 0, 48, 11, 2, 2, 6, 180, 2, 1, 1, 4, 2, 12, 0, 48, 11, 2, 2, 6, 181, 2,
       1, 1, 4, 2, 12, 0, 48, 11, 2, 2, 6, 182, 2, 1, 1, 4, 2, 12, 0, 48, 12, 2, 2,
       6, 165, 2, 1, 1, 4, 3, 2, 1, 1, 48, 12, 2, 2, 6, 171, 2, 1, 1, 4, 3, 2, 1,
       0, 48, 12, 2, 2, 6, 174, 2, 1, 1, 4, 3, 2, 1, 0, 48, 12, 2, 2, 6, 175, 2, 1,
       1, 4, 3, 2, 1, 0, 48, 12, 2, 2, 6, 177, 2, 1, 1, 4, 3, 2, 1, 0, 48, 27, 2,
       2, 6, 167, 2, 1, 1, 4, 18, 12, 16, 49, 48, 48, 48, 48, 48, 48, 49, 50, 50,
       49, 48, 50, 51, 52, 56, 48, 27, 2, 2, 6, 169, 2, 1, 1, 4, 18, 12, 16, 49,
       48, 48, 48, 48, 48, 48, 49, 50, 50, 49, 48, 50, 51, 52, 56, 48, 31, 2, 2, 6,
       168, 2, 1, 1, 4, 22, 22, 20, 50, 48, 49, 52, 45, 48, 57, 45, 48, 50, 84, 48,
       51, 58, 50, 57, 58, 48, 54, 90, 48, 31, 2, 2, 6, 170, 2, 1, 1, 4, 22, 22,
       20, 50, 48, 49, 52, 45, 48, 57, 45, 48, 50, 84, 48, 51, 58, 50, 57, 58, 48,
       54, 90, 48, 37, 2, 2, 6, 166, 2, 1, 1, 4, 28, 12, 26, 99, 111, 109, 46, 115,
       117, 109, 105, 97, 112, 112, 46, 103, 114, 105, 100, 100, 105, 97, 114, 121,
       46, 116, 101, 115, 116>>}]
  end
end
